# SION Personal Assistant - 아키텍처 문서

## 개요

SION은 Docker와 AWS를 활용한 AI 기반 개인 비서 시스템입니다. 로컬 클라이언트와 클라우드 백엔드의 하이브리드 구조로 설계되었습니다.

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              로컬 PC                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   ┌──────────────────┐        ┌──────────────────┐                      │
│   │   C++ Hotkey     │──────▶│  Python Client   │                      │
│   │   Module         │        │  (API 호출)       │                      │
│   │                  │        │                  │                      │
│   │  • 글로벌 핫키    │        │  • 음성 녹음      │                      │
│   │  • 시스템 연동    │        │  • 오디오 처리    │                      │
│   └──────────────────┘        └────────┬─────────┘                      │
│                                        │                                 │
│   ┌──────────────────────────────────┐ │                                │
│   │     로컬 Task Execution          │◀┘                                │
│   │  • 파일 탐색                      │                                  │
│   │  • 앱 실행                        │                                  │
│   │  • 시스템 제어                    │                                  │
│   └──────────────────────────────────┘                                  │
│                                                                          │
└─────────────────────────────┬───────────────────────────────────────────┘
                              │
                              │ HTTPS/REST API
                              ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           AWS Cloud                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                      API Gateway                                  │   │
│   └────────┬────────────────────┬─────────────────────┬─────────────┘   │
│            │                    │                     │                  │
│            ▼                    ▼                     ▼                  │
│   ┌─────────────┐      ┌─────────────┐      ┌─────────────────┐        │
│   │     ASR     │      │     NLU     │      │  Task Executor  │        │
│   │   Service   │      │   Service   │      │    Service      │        │
│   │             │      │             │      │                 │        │
│   │  Whisper    │      │ BERT/Rule   │      │ • Email        │        │
│   │  Model      │      │ Based       │      │ • Calendar     │        │
│   └──────┬──────┘      └──────┬──────┘      │ • LLM          │        │
│          │                    │             └────────┬────────┘        │
│          │                    │                      │                  │
│   ┌──────▼────────────────────▼──────────────────────▼──────────┐      │
│   │                        EC2 / ECS                              │      │
│   │                   (Docker Containers)                         │      │
│   └───────────────────────────┬──────────────────────────────────┘      │
│                               │                                          │
│                               ▼                                          │
│   ┌───────────────────────────────────────────────────────────────┐     │
│   │                    AWS Services                                │     │
│   │                                                                │     │
│   │   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐      │     │
│   │   │   ECR   │   │   S3    │   │ Lambda  │   │DynamoDB │      │     │
│   │   │ (이미지)│   │ (로그)   │   │(간헐작업)│   │ (일정)  │      │     │
│   │   └─────────┘   └─────────┘   └─────────┘   └─────────┘      │     │
│   └───────────────────────────────────────────────────────────────┘     │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 컴포넌트 설명

### 1. 클라이언트 (로컬 PC)

#### C++ Hotkey Module
- **역할**: 시스템 전역 핫키 감지 및 음성 캡처
- **기술**: Windows API, WASAPI
- **책임**:
  - 글로벌 핫키 등록/감지 (Ctrl+Shift+S)
  - 마이크 오디오 캡처
  - Python 프로세스와 IPC 통신

#### Python Client
- **역할**: API 통신 및 로컬 작업 조율
- **기술**: Python, httpx, sounddevice
- **책임**:
  - 오디오 녹음 및 전처리
  - AWS API 호출
  - 응답 처리 및 로컬 작업 실행

### 2. 백엔드 서비스 (AWS)

#### ASR Service
- **역할**: 음성을 텍스트로 변환
- **기술**: OpenAI Whisper, FastAPI
- **API**: `POST /transcribe`
- **입력**: WAV 오디오 파일
- **출력**: 인식된 텍스트, 언어, 세그먼트 정보

#### NLU Service
- **역할**: 텍스트에서 의도와 엔티티 추출
- **기술**: BERT/Rule-based, FastAPI
- **API**: `POST /analyze`
- **입력**: 텍스트
- **출력**: 의도(intent), 엔티티(entities)

#### Task Executor Service
- **역할**: 의도에 따른 작업 실행
- **기술**: FastAPI, Google APIs, OpenAI
- **지원 작업**:
  - 이메일 확인/전송 (Gmail API)
  - 일정 관리 (Google Calendar API)
  - LLM 대화 (OpenAI API)

### 3. AWS 인프라

#### ECR (Elastic Container Registry)
- Docker 이미지 저장소
- 서비스별 리포지토리: sion-asr, sion-nlu, sion-task-executor

#### EC2 / ECS
- 컨테이너 실행 환경
- Docker Compose로 서비스 오케스트레이션

#### S3
- 로그 저장
- 모델 파일 저장

#### Lambda
- 간헐적 작업 (이메일 확인, 일정 알림)

#### DynamoDB
- 일정 데이터 저장

## 데이터 플로우

### 음성 명령 처리 플로우

```
1. 사용자가 Ctrl+Shift+S 누름
          ↓
2. C++ Hotkey Module이 핫키 감지
          ↓
3. 음성 녹음 시작 (5초 또는 무음 감지까지)
          ↓
4. WAV 오디오 데이터를 Python Client로 전달
          ↓
5. Python Client가 ASR API 호출
          ↓
6. ASR Service가 음성을 텍스트로 변환
          ↓
7. Python Client가 NLU API 호출
          ↓
8. NLU Service가 의도/엔티티 추출
          ↓
9. 의도에 따라:
   - 로컬 작업 → Python Client에서 직접 실행
   - 원격 작업 → Task Executor API 호출
          ↓
10. 결과를 사용자에게 표시/알림
```

## 배포 전략

### 개발 환경
- Docker Compose로 로컬에서 모든 서비스 실행
- Hot reload 활성화

### 스테이징/프로덕션
- CloudFormation으로 인프라 프로비저닝
- ECR에 이미지 푸시
- EC2에 Docker Compose 배포

## 확장성 고려사항

1. **수평 확장**: ECS/EKS로 마이그레이션하여 Auto Scaling 적용
2. **모델 최적화**: GPU 인스턴스 또는 SageMaker Endpoint 사용
3. **캐싱**: Redis/ElastiCache로 NLU 결과 캐싱
4. **CDN**: CloudFront로 정적 리소스 배포

## 보안

1. **인증**: API Gateway + Lambda Authorizer
2. **암호화**: HTTPS, KMS로 민감 데이터 암호화
3. **IAM**: 최소 권한 원칙 적용
4. **VPC**: Private Subnet에 백엔드 서비스 배치

